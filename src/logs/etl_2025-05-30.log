2025-05-30 00:27:22,936 - etl_pipeline - INFO - Iniciando ETL Master
2025-05-30 00:27:24,135 - etl_pipeline - INFO - Cargando a staging ... dim_cliente
2025-05-30 00:27:24,192 - etl_pipeline - INFO - Transformando... dim_cliente
2025-05-30 00:27:24,198 - etl_pipeline - INFO - Transformación exitosa. Filas procesadas: 27
2025-05-30 00:27:24,198 - etl_pipeline - INFO - Cargando a destino... dim_cliente
2025-05-30 00:27:24,222 - etl_pipeline - ERROR - Error en carga de datos
Traceback (most recent call last):
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: llave duplicada viola restricción de unicidad «dim_cliente_pkey»
DETAIL:  Ya existe la llave (cliente_key)=(1).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\src\load\load_dim_cliente.py", line 69, in load_data
    df.to_sql(
    ~~~~~~~~~^
        'dim_cliente',
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        chunksize=1000   # Inserta en lotes de 1000 registros
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\core\generic.py", line 3087, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 2018, in to_sql
    total_inserted = sql_engine.insert_records(
        table=table,
    ...<7 lines>...
        **engine_kwargs,
    )
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 1567, in insert_records
    raise err
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 1558, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 1119, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\pandas\io\sql.py", line 1027, in _execute_insert_multi
    result = conn.execute(stmt)
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Camilo\Dev\maestria-proyecto-mensajeria-etl\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) llave duplicada viola restricción de unicidad «dim_cliente_pkey»
DETAIL:  Ya existe la llave (cliente_key)=(1).

[SQL: INSERT INTO dim_cliente (cliente_key, nit, nombre, email, direccion, telefono, ciudad, departamento, sector, activo) VALUES (%(cliente_key_m0)s, %(nit_m0)s, %(nombre_m0)s, %(email_m0)s, %(direccion_m0)s, %(telefono_m0)s, %(ciudad_m0)s, %(departamento_m0)s, %(sector_m0)s, %(activo_m0)s), (%(cliente_key_m1)s, %(nit_m1)s, %(nombre_m1)s, %(email_m1)s, %(direccion_m1)s, %(telefono_m1)s, %(ciudad_m1)s, %(departamento_m1)s, %(sector_m1)s, %(activo_m1)s), (%(cliente_key_m2)s, %(nit_m2)s, %(nombre_m2)s, %(email_m2)s, %(direccion_m2)s, %(telefono_m2)s, %(ciudad_m2)s, %(departamento_m2)s, %(sector_m2)s, %(activo_m2)s), (%(cliente_key_m3)s, %(nit_m3)s, %(nombre_m3)s, %(email_m3)s, %(direccion_m3)s, %(telefono_m3)s, %(ciudad_m3)s, %(departamento_m3)s, %(sector_m3)s, %(activo_m3)s), (%(cliente_key_m4)s, %(nit_m4)s, %(nombre_m4)s, %(email_m4)s, %(direccion_m4)s, %(telefono_m4)s, %(ciudad_m4)s, %(departamento_m4)s, %(sector_m4)s, %(activo_m4)s), (%(cliente_key_m5)s, %(nit_m5)s, %(nombre_m5)s, %(email_m5)s, %(direccion_m5)s, %(telefono_m5)s, %(ciudad_m5)s, %(departamento_m5)s, %(sector_m5)s, %(activo_m5)s), (%(cliente_key_m6)s, %(nit_m6)s, %(nombre_m6)s, %(email_m6)s, %(direccion_m6)s, %(telefono_m6)s, %(ciudad_m6)s, %(departamento_m6)s, %(sector_m6)s, %(activo_m6)s), (%(cliente_key_m7)s, %(nit_m7)s, %(nombre_m7)s, %(email_m7)s, %(direccion_m7)s, %(telefono_m7)s, %(ciudad_m7)s, %(departamento_m7)s, %(sector_m7)s, %(activo_m7)s), (%(cliente_key_m8)s, %(nit_m8)s, %(nombre_m8)s, %(email_m8)s, %(direccion_m8)s, %(telefono_m8)s, %(ciudad_m8)s, %(departamento_m8)s, %(sector_m8)s, %(activo_m8)s), (%(cliente_key_m9)s, %(nit_m9)s, %(nombre_m9)s, %(email_m9)s, %(direccion_m9)s, %(telefono_m9)s, %(ciudad_m9)s, %(departamento_m9)s, %(sector_m9)s, %(activo_m9)s), (%(cliente_key_m10)s, %(nit_m10)s, %(nombre_m10)s, %(email_m10)s, %(direccion_m10)s, %(telefono_m10)s, %(ciudad_m10)s, %(departamento_m10)s, %(sector_m10)s, %(activo_m10)s), (%(cliente_key_m11)s, %(nit_m11)s, %(nombre_m11)s, %(email_m11)s, %(direccion_m11)s, %(telefono_m11)s, %(ciudad_m11)s, %(departamento_m11)s, %(sector_m11)s, %(activo_m11)s), (%(cliente_key_m12)s, %(nit_m12)s, %(nombre_m12)s, %(email_m12)s, %(direccion_m12)s, %(telefono_m12)s, %(ciudad_m12)s, %(departamento_m12)s, %(sector_m12)s, %(activo_m12)s), (%(cliente_key_m13)s, %(nit_m13)s, %(nombre_m13)s, %(email_m13)s, %(direccion_m13)s, %(telefono_m13)s, %(ciudad_m13)s, %(departamento_m13)s, %(sector_m13)s, %(activo_m13)s), (%(cliente_key_m14)s, %(nit_m14)s, %(nombre_m14)s, %(email_m14)s, %(direccion_m14)s, %(telefono_m14)s, %(ciudad_m14)s, %(departamento_m14)s, %(sector_m14)s, %(activo_m14)s), (%(cliente_key_m15)s, %(nit_m15)s, %(nombre_m15)s, %(email_m15)s, %(direccion_m15)s, %(telefono_m15)s, %(ciudad_m15)s, %(departamento_m15)s, %(sector_m15)s, %(activo_m15)s), (%(cliente_key_m16)s, %(nit_m16)s, %(nombre_m16)s, %(email_m16)s, %(direccion_m16)s, %(telefono_m16)s, %(ciudad_m16)s, %(departamento_m16)s, %(sector_m16)s, %(activo_m16)s), (%(cliente_key_m17)s, %(nit_m17)s, %(nombre_m17)s, %(email_m17)s, %(direccion_m17)s, %(telefono_m17)s, %(ciudad_m17)s, %(departamento_m17)s, %(sector_m17)s, %(activo_m17)s), (%(cliente_key_m18)s, %(nit_m18)s, %(nombre_m18)s, %(email_m18)s, %(direccion_m18)s, %(telefono_m18)s, %(ciudad_m18)s, %(departamento_m18)s, %(sector_m18)s, %(activo_m18)s), (%(cliente_key_m19)s, %(nit_m19)s, %(nombre_m19)s, %(email_m19)s, %(direccion_m19)s, %(telefono_m19)s, %(ciudad_m19)s, %(departamento_m19)s, %(sector_m19)s, %(activo_m19)s), (%(cliente_key_m20)s, %(nit_m20)s, %(nombre_m20)s, %(email_m20)s, %(direccion_m20)s, %(telefono_m20)s, %(ciudad_m20)s, %(departamento_m20)s, %(sector_m20)s, %(activo_m20)s), (%(cliente_key_m21)s, %(nit_m21)s, %(nombre_m21)s, %(email_m21)s, %(direccion_m21)s, %(telefono_m21)s, %(ciudad_m21)s, %(departamento_m21)s, %(sector_m21)s, %(activo_m21)s), (%(cliente_key_m22)s, %(nit_m22)s, %(nombre_m22)s, %(email_m22)s, %(direccion_m22)s, %(telefono_m22)s, %(ciudad_m22)s, %(departamento_m22)s, %(sector_m22)s, %(activo_m22)s), (%(cliente_key_m23)s, %(nit_m23)s, %(nombre_m23)s, %(email_m23)s, %(direccion_m23)s, %(telefono_m23)s, %(ciudad_m23)s, %(departamento_m23)s, %(sector_m23)s, %(activo_m23)s), (%(cliente_key_m24)s, %(nit_m24)s, %(nombre_m24)s, %(email_m24)s, %(direccion_m24)s, %(telefono_m24)s, %(ciudad_m24)s, %(departamento_m24)s, %(sector_m24)s, %(activo_m24)s), (%(cliente_key_m25)s, %(nit_m25)s, %(nombre_m25)s, %(email_m25)s, %(direccion_m25)s, %(telefono_m25)s, %(ciudad_m25)s, %(departamento_m25)s, %(sector_m25)s, %(activo_m25)s), (%(cliente_key_m26)s, %(nit_m26)s, %(nombre_m26)s, %(email_m26)s, %(direccion_m26)s, %(telefono_m26)s, %(ciudad_m26)s, %(departamento_m26)s, %(sector_m26)s, %(activo_m26)s)]
[parameters: {'cliente_key_m0': 1, 'nit_m0': '25', 'nombre_m0': 'CLIENTE 2', 'email_m0': 'algo.com', 'direccion_m0': 'Calle 100 No 25-18', 'telefono_m0': '327-00000', 'ciudad_m0': 'CALI', 'departamento_m0': 'VALLE DEL CAUCA', 'sector_m0': 'S', 'activo_m0': True, 'cliente_key_m1': 2, 'nit_m1': '123', 'nombre_m1': 'CLIENTE 1', 'email_m1': 'algo.com', 'direccion_m1': 'Calle 100 No 25-18', 'telefono_m1': '327-00000', 'ciudad_m1': 'CALI', 'departamento_m1': 'VALLE DEL CAUCA', 'sector_m1': 'INDUSTRIAL', 'activo_m1': True, 'cliente_key_m2': 3, 'nit_m2': '312289-5', 'nombre_m2': 'BANCO REGIONAL  DE SANGRE BLOD-LIFE', 'email_m2': 'algo.com', 'direccion_m2': 'Calle 100 No 25-18', 'telefono_m2': '327-00000', 'ciudad_m2': 'CALI', 'departamento_m2': 'VALLE DEL CAUCA', 'sector_m2': 'SALUD', 'activo_m2': True, 'cliente_key_m3': 4, 'nit_m3': '306215-0', 'nombre_m3': 'CRUZ AZUL-LIFE', 'email_m3': 'algo.com', 'direccion_m3': 'Calle 100 No 25-18', 'telefono_m3': '327-00000', 'ciudad_m3': 'CALI', 'departamento_m3': 'VALLE DEL CAUCA', 'sector_m3': 'SALUD', 'activo_m3': True, 'cliente_key_m4': 5, 'nit_m4': '300513-3', 'nombre_m4': 'CLINICA CALI -JOVEN', 'email_m4': 'algo.com', 'direccion_m4': 'Calle 100 No 25-18', 'telefono_m4': '327-00000', 'ciudad_m4': 'CALI', 'departamento_m4': 'VALLE DEL CAUCA', 'sector_m4': 'SALUD', 'activo_m4': True ... 170 parameters truncated ... 'cliente_key_m22': 23, 'nit_m22': '900603', 'nombre_m22': 'CLINICA MEDICA S.A.S', 'email_m22': 'algo.com', 'direccion_m22': 'Calle 100 No 25-18', 'telefono_m22': '327-00000', 'ciudad_m22': 'CALI', 'departamento_m22': 'VALLE DEL CAUCA', 'sector_m22': 'SALUD', 'activo_m22': True, 'cliente_key_m23': 24, 'nit_m23': '9009754', 'nombre_m23': 'CLINICA SAN RAFAEL DE OCCIDENTE', 'email_m23': 'algo.com', 'direccion_m23': 'Calle 100 No 25-18', 'telefono_m23': '327-00000', 'ciudad_m23': 'CALI', 'departamento_m23': 'VALLE DEL CAUCA', 'sector_m23': 'SALUD', 'activo_m23': True, 'cliente_key_m24': 25, 'nit_m24': '900361', 'nombre_m24': 'CALI SULUD Y VIDA', 'email_m24': 'algo.com', 'direccion_m24': 'Calle 100 No 25-18', 'telefono_m24': '327-00000', 'ciudad_m24': 'CALI', 'departamento_m24': 'VALLE DEL CAUCA', 'sector_m24': 'SALUD', 'activo_m24': True, 'cliente_key_m25': 26, 'nit_m25': '25478', 'nombre_m25': 'OCCIDENTE DE SALUD-CALI', 'email_m25': 'algo.com', 'direccion_m25': 'Calle 100 No 25-18', 'telefono_m25': '327-00000', 'ciudad_m25': 'CALI', 'departamento_m25': 'VALLE DEL CAUCA', 'sector_m25': 'SALUD', 'activo_m25': True, 'cliente_key_m26': 27, 'nit_m26': '201478', 'nombre_m26': 'MEDICOS Y SALUD', 'email_m26': 'algo.com', 'direccion_m26': 'Calle 100 No 25-18', 'telefono_m26': '327-00000', 'ciudad_m26': 'CALI', 'departamento_m26': 'VALLE DEL CAUCA', 'sector_m26': 'INDUSTRIAL', 'activo_m26': True}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-30 00:27:24,254 - etl_pipeline - INFO - Resumen de ejecución:
2025-05-30 00:27:24,254 - etl_pipeline - INFO -   - DIM_CLIENTE    : FALLÓ
2025-05-30 00:27:24,255 - etl_pipeline - ERROR - Algunos pipelines fallaron. Ver logs.
2025-05-30 00:30:59,448 - etl_pipeline - INFO - Iniciando ETL Master
2025-05-30 00:31:00,509 - etl_pipeline - INFO - Cargando a staging ... dim_cliente
2025-05-30 00:31:00,575 - etl_pipeline - INFO - Transformando... dim_cliente
2025-05-30 00:31:00,582 - etl_pipeline - INFO - Transformación exitosa. Filas procesadas: 27
2025-05-30 00:31:00,583 - etl_pipeline - INFO - Cargando a destino... dim_cliente
2025-05-30 00:31:00,591 - etl_pipeline - WARNING - ¡Tabla dim_cliente truncada (carga completa)!
2025-05-30 00:31:00,606 - etl_pipeline - INFO - Carga exitosa. Total registros en dim_cliente: 27
2025-05-30 00:31:00,606 - etl_pipeline - INFO - ETL completado. Filas cargadas: 27 en dim_cliente
2025-05-30 00:31:00,612 - etl_pipeline - INFO - Resumen de ejecución:
2025-05-30 00:31:00,612 - etl_pipeline - INFO -   - DIM_CLIENTE    : ÉXITO
2025-05-30 00:31:00,613 - etl_pipeline - INFO - ¡Todos los pipelines completados con éxito!
2025-05-30 00:31:29,054 - etl_pipeline - INFO - Iniciando ETL Master
2025-05-30 00:31:30,005 - etl_pipeline - INFO - Cargando a staging ... dim_cliente
2025-05-30 00:31:30,065 - etl_pipeline - INFO - Transformando... dim_cliente
2025-05-30 00:31:30,070 - etl_pipeline - INFO - Transformación exitosa. Filas procesadas: 27
2025-05-30 00:31:30,070 - etl_pipeline - INFO - Cargando a destino... dim_cliente
2025-05-30 00:31:30,076 - etl_pipeline - WARNING - ¡Tabla dim_cliente truncada (carga completa)!
2025-05-30 00:31:30,090 - etl_pipeline - INFO - Carga exitosa. Total registros en dim_cliente: 27
2025-05-30 00:31:30,090 - etl_pipeline - INFO - ETL completado. Filas cargadas: 27 en dim_cliente
2025-05-30 00:31:30,094 - etl_pipeline - INFO - SUCCESS DIM_CLIENTE
2025-05-30 00:31:30,094 - etl_pipeline - INFO - Resumen de ejecución:
2025-05-30 00:31:30,094 - etl_pipeline - INFO -   - DIM_CLIENTE    : ÉXITO
2025-05-30 00:31:30,094 - etl_pipeline - INFO - ¡Todos los pipelines completados con éxito!
2025-05-30 00:31:53,951 - etl_pipeline - INFO - Iniciando ETL Master
2025-05-30 00:31:54,823 - etl_pipeline - INFO - Extrayendo datos... dim_cliente
2025-05-30 00:31:54,931 - etl_pipeline - INFO - Cargando a staging ... dim_cliente
2025-05-30 00:31:54,982 - etl_pipeline - INFO - Transformando... dim_cliente
2025-05-30 00:31:54,986 - etl_pipeline - INFO - Transformación exitosa. Filas procesadas: 27
2025-05-30 00:31:54,986 - etl_pipeline - INFO - Cargando a destino... dim_cliente
2025-05-30 00:31:54,993 - etl_pipeline - WARNING - ¡Tabla dim_cliente truncada (carga completa)!
2025-05-30 00:31:55,007 - etl_pipeline - INFO - Carga exitosa. Total registros en dim_cliente: 27
2025-05-30 00:31:55,007 - etl_pipeline - INFO - ETL completado. Filas cargadas: 27 en dim_cliente
2025-05-30 00:31:55,010 - etl_pipeline - INFO - SUCCESS DIM_CLIENTE
2025-05-30 00:31:55,010 - etl_pipeline - INFO - Resumen de ejecución:
2025-05-30 00:31:55,010 - etl_pipeline - INFO -   - DIM_CLIENTE    : ÉXITO
2025-05-30 00:31:55,010 - etl_pipeline - INFO - ¡Todos los pipelines completados con éxito!
